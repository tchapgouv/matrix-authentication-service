{% import "components/icon.html" as icon %}
{% import "components/field.html" as field %}

{% macro password_field(label, name, form_state=false, class="") %}
    {% call(f) field.field(label=label, name=name, form_state=form_state, class=class) %}
      <div class="password-field-container">
        <input {{ field.attributes(f) }} class="cpd-text-control" type="password" autocomplete="password" required />
        <button type="button" class="password-toggle" onclick="togglePasswordVisibility(this)">
          {{ icon.visibility_off() }}
        </button>
      </div>
    {% endcall %}


<style>
.password-field-container {
  position: relative;
  display: flex;
  align-items: center;
}

.password-field-container input {
  width: 100%;
  padding-right: 40px; /* Make room for the toggle button */
}

.password-toggle {
  position: absolute;
  right: 8px;
  height: 24px;
  width: 24px;
  cursor: pointer;
  color: var(--cpd-color-text-secondary);
  z-index: 1;
}

.password-toggle:hover {
  color: var(--cpd-color-text-primary);
}

.password-toggle:focus {
  outline: none;
  box-shadow: 0 0 0 2px var(--cpd-color-border-focused);
}
</style>

<script>
function togglePasswordVisibility(button) {
  const input = button.previousElementSibling;
  if (input.type === "password") {
    input.type = "text";
    button.innerHTML = `{{ icon.visibility_on() }}`;
    button.setAttribute('aria-label', 'Masquer le mot de passe');
    button.setAttribute('title', 'Masquer le mot de passe');
  } else {
    input.type = "password";
    button.innerHTML = `{{ icon.visibility_off() }}`;
    button.setAttribute('aria-label', 'Afficher le mot de passe');
    button.setAttribute('title', 'Afficher le mot de passe');
  }
}
</script>

{% endmacro %}
