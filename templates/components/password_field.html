{% import "components/icon.html" as icon %}
{% import "components/field.html" as field %}

{% macro password_field(label, name, form_state=false, class="") %}
    <div class="password-field-container" style="position: relative;">
      <input {{ field.attributes(f) }} class="cpd-text-control" type="password" autocomplete="password" required />
      <button type="button" class="password-toggle" onclick="togglePasswordVisibility(this)" aria-label="Afficher le mot de passe" title="Afficher le mot de passe">
        {{ icon.visibility_off() }}
      </button>
    </div>
{% endmacro %}

<style>
.password-field-container {
  position: relative;
}

.password-toggle {
  position: absolute;
  right: 0;
  top: 0;
  height: 100%;
  width: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: none;
  border: none;
  border-left: 1px solid var(--cpd-color-border-interactive-primary);
  cursor: pointer;
  color: var(--cpd-color-text-secondary);
}

.password-toggle:hover {
  color: var(--cpd-color-text-primary);
}

.password-toggle:focus {
  outline: none;
  box-shadow: 0 0 0 2px var(--cpd-color-border-focused);
}

.password-field-container input {
  padding-right: 48px; /* Make room for the toggle button */
}
</style>

<script>
function togglePasswordVisibility(button) {
  const input = button.previousElementSibling;
  if (input.type === "password") {
    input.type = "text";
    button.innerHTML = `{{ icon.visibility_on() }}`;
    button.setAttribute('aria-label', 'Masquer le mot de passe');
    button.setAttribute('title', 'Masquer le mot de passe');
  } else {
    input.type = "password";
    button.innerHTML = `{{ icon.visibility_off() }}`;
    button.setAttribute('aria-label', 'Afficher le mot de passe');
    button.setAttribute('title', 'Afficher le mot de passe');
  }
}
</script>
